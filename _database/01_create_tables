-- functions needed for table structure
CREATE FUNCTION now_utc()
  RETURNS TIMESTAMP WITH TIME ZONE AS $$
SET LOCAL TIMEZONE = 'UTC';
SELECT now();
$$ LANGUAGE SQL;

-- regular table structure
CREATE TABLE skills
(
  id              SERIAL PRIMARY KEY       NOT NULL,
  code            TEXT                     NULL,
  academics       INT                      NULL,
  computer        INT                      NULL,
  concentration   INT                      NULL,
  crafting        INT                      NULL,
  investigation   INT                      NULL,
  medicine        INT                      NULL,
  occult          INT                      NULL,
  politics        INT                      NULL,
  science          INT                      NULL,
  athletics       INT                      NULL,
  brawl           INT                      NULL,
  demolitions     INT                      NULL,
  drive           INT                      NULL,
  firearms        INT                      NULL,
  larceny         INT                      NULL,
  ranged_weaponry INT                      NULL,
  ride            INT                      NULL,
  stealth         INT                      NULL,
  survival        INT                      NULL,
  weaponry         INT                      NULL,
  animal_kinship  INT                      NULL,
  bluff           INT                      NULL,
  empathy         INT                      NULL,
  expression      INT                      NULL,
  intimidate      INT                      NULL,
  persuasion      INT                      NULL,
  social_contacts INT                      NULL,
  streetwise      INT                      NULL,
  subterfuge      INT                      NULL,
  updated_at      TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),
  created_at      TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),

  CHECK (EXTRACT(TIMEZONE FROM updated_at) = '0'),
  CHECK (EXTRACT(TIMEZONE FROM created_at) = '0')

);

CREATE TABLE character
(
  id            SERIAL PRIMARY KEY       NOT NULL,
  code          TEXT                     NOT NULL,
  name          TEXT                     NOT NULL,
  species       TEXT                     NOT NULL,
  species_size  TEXT                     NOT NULL,
  sex           TEXT                     NOT NULL,
  faction       TEXT                     NULL,
  alg           TEXT                     NOT NULL,
  pocc          TEXT                     NOT NULL,
  socc          TEXT                     NULL,
  exp_total     INT                      NOT NULL,
  exp_remaining INT                      NOT NULL,
  hp            INT                      NOT NULL,
  soak          INT                      NOT NULL,
  stuffing      INT                      NOT NULL,
  sanity        INT                      NOT NULL,
  str           INT                      NOT NULL,
  int           INT                      NOT NULL,
  dex           INT                      NOT NULL,
  con           INT                      NOT NULL,
  wis           INT                      NOT NULL,
  cha           INT                      NOT NULL,
  skills_id     INT                      NOT NULL,
  merits_id     INT                      NOT NULL,
  flaws_id      INT                      NOT NULL,
  updated_at    TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),
  created_at    TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),

  CHECK (EXTRACT(TIMEZONE FROM updated_at) = '0'),
  CHECK (EXTRACT(TIMEZONE FROM created_at) = '0'),

  FOREIGN KEY (skills_id) REFERENCES skills (id)

);

CREATE TABLE character_code
(
  id           SERIAL PRIMARY KEY       NOT NULL,
  code         TEXT                     NOT NULL,
  display_name TEXT                     NULL,
  updated_at   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),
  created_at   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),

  CHECK (EXTRACT(TIMEZONE FROM updated_at) = '0'),
  CHECK (EXTRACT(TIMEZONE FROM created_at) = '0')
);

CREATE TABLE inventory_pc
(
  id           SERIAL PRIMARY KEY       NOT NULL,
  code         TEXT                     NOT NULL,
  character_id TEXT                     NOT NULL,
  updated_at   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),
  created_at   TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now_utc(),

  CHECK (EXTRACT(TIMEZONE FROM updated_at) = '0'),
  CHECK (EXTRACT(TIMEZONE FROM created_at) = '0')
);
